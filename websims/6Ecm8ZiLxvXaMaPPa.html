<html><head><base href="https://ulayamanote.tokyo/">
<meta charset="UTF-8">
<title>Psychedelic Yamanote Line Visualizer</title>
<style>
  body {
    margin: 0;
    background: #000;
    overflow: hidden;
    font-family: 'Press Start 2P', monospace;
  }
  
  .station {
    position: absolute;
    width: 20px;
    height: 20px;
    background: #fff;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }
  
  .track {
    stroke-dasharray: 20;
    animation: dash 2s linear infinite;
  }
  
  .train-car {
    fill: #ff00ff;
    filter: drop-shadow(0 0 10px #ff00ff);
    animation: glow 1s ease-in-out infinite alternate;
  }
  
  .player-marker {
    fill: #00ff00;
    filter: drop-shadow(0 0 15px #00ff00);
    animation: playerPulse 1s ease-in-out infinite;
  }
  
  @keyframes dash {
    to {
      stroke-dashoffset: -40;
    }
  }
  
  @keyframes glow {
    from { filter: drop-shadow(0 0 5px #ff00ff); }
    to { filter: drop-shadow(0 0 20px #ff00ff); }
  }
  
  @keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 0.5; }
    100% { transform: scale(1); opacity: 1; }
  }

  @keyframes playerPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }
  
  .info-panel {
    position: fixed;
    right: 40px;
    top: 40px;
    background: rgba(0,0,0,0.8);
    color: #0f0;
    padding: 30px;
    border: 2px solid #0f0;
    text-shadow: 0 0 5px #0f0;
    font-size: 16px;
    min-width: 300px;
  }

  .announcement {
    position: fixed;
    left: 40px;
    top: 40px;
    background: rgba(255,0,0,0.2);
    color: #fff;
    padding: 30px;
    border: 2px solid #ff0;
    text-shadow: 0 0 5px #ff0;
    font-size: 20px;
    animation: glitch 1s infinite;
    min-width: 400px;
  }

  .last-carriage-notice {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,255,0.2);
    color: #fff;
    padding: 30px;
    border: 2px solid #00f;
    text-shadow: 0 0 5px #00f;
    font-size: 16px;
    text-align: center;
    width: 600px;
  }

  button {
    background: #0f0;
    color: black;
    border: none;
    padding: 10px 20px;
    margin: 10px 0;
    font-family: 'Press Start 2P', monospace;
    cursor: pointer;
    font-size: 14px;
  }

  button:hover {
    background: #0f0;
    filter: brightness(1.2);
  }

  #controls {
    position: fixed;
    left: 50%;
    top: 40px;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.8);
    padding: 20px;
    border: 2px solid #f0f;
    display: flex;
    gap: 20px;
  }

  @keyframes glitch {
    0% { transform: translateX(0); }
    25% { transform: translateX(2px); }
    50% { transform: translateX(-2px); }
    75% { transform: translateX(1px); }
    100% { transform: translateX(0); }
  }
</style>
</head>
<body>

<div class="announcement">
  ULA YAMANOTE 発表 / ANNOUNCEMENT:<br>
  トラフィッククラブ東京 / TRAFFIC CLUB TOKYO<br>
  12月7日 / DECEMBER 7TH<br>
  六本木 / ROPPONGI
</div>

<div id="controls">
  <button onclick="togglePlayPause()" id="playPauseBtn">PLAY</button>
  <button onclick="toggleMode()">TOGGLE GPS/SIMULATION</button>
  <div id="mode-indicator" style="color: #0f0; margin-left: 20px;">MODE: SIMULATION</div>
</div>

<div class="last-carriage-notice">
  最後の車両でサウンドトラックを楽しみましょう<br>
  ENJOY THE SOUNDTRACK IN THE LAST CARRIAGE<br>
  他のリスナーと出会うために、携帯のライトをオンにしてください<br>
  TURN ON YOUR PHONE LIGHT TO MEET OTHER LISTENERS
</div>

<svg id="yamanote" width="100%" height="100vh" viewBox="200 100 600 600">
  <defs>
    <linearGradient id="trackGradient">
      <stop offset="0%" style="stop-color:#00ff00"/>
      <stop offset="100%" style="stop-color:#0000ff"/>
    </linearGradient>
  </defs>
  
  <path class="track" d="M300,300 C450,200 550,200 700,300 S800,450 700,600 S450,700 300,600 S200,450 300,300" 
        fill="none" stroke="url(#trackGradient)" stroke-width="4"/>
  
  <g class="train">
    <g class="train-car" transform="translate(0,0)">
      <rect x="-15" y="-10" width="30" height="20" rx="5"/>
      <circle cx="0" cy="0" r="5" fill="#fff"/>
    </g>
    <g class="train-car" transform="translate(-35,0)">
      <rect x="-15" y="-10" width="30" height="20" rx="5"/>
      <circle cx="0" cy="0" r="5" fill="#fff"/>
    </g>
    <g class="train-car" transform="translate(-70,0)">
      <rect x="-15" y="-10" width="30" height="20" rx="5"/>
      <circle cx="0" cy="0" r="5" fill="#fff"/>
    </g>
    
    <g class="player-marker" transform="translate(-35,0)">
      <polygon points="0,-15 5,-5 -5,-5" />
    </g>
  </g>
</svg>

<div class="info-panel">
  次の駅 / NEXT STATION:<br>
  <span id="current-station">渋谷 / SHIBUYA</span><br>
  <br>
  現在地 / LOCATION:<br>
  <span id="coordinates">35.658034, 139.701636</span><br>
  <br>
  車両番号 / CAR NUMBER:<br>
  <span id="car-number">2</span>
</div>

<audio id="stationSound" src="https://github.com/pollinations/ula-yamanote.tokyo/raw/refs/heads/main/convenience%20store%20-%20shabu%20shabu%20-%20please%20be%20careful.mp3"></audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
const stations = [
  {name: "Shibuya", jp: "渋谷", pos: {x: 300, y: 300}},
  {name: "Harajuku", jp: "原宿", pos: {x: 450, y: 250}},
  {name: "Shinjuku", jp: "新宿", pos: {x: 550, y: 250}},
  {name: "Ikebukuro", jp: "池袋", pos: {x: 700, y: 300}},
];

let isSimulationMode = true;
let currentStationIndex = 0;
let trainMoving = true;
let trainAnimation;
let isPaused = true;

const stationSound = document.getElementById('stationSound');
stationSound.volume = 0.5;

function togglePlayPause() {
  isPaused = !isPaused;
  document.getElementById('playPauseBtn').textContent = isPaused ? 'PLAY' : 'PAUSE';
  if (isPaused) {
    trainAnimation.pause();
    stationSound.pause();
  } else {
    trainAnimation.play();
    stationSound.play().catch(e => console.log("Audio playback failed:", e));
  }
}

function toggleMode() {
  isSimulationMode = !isSimulationMode;
  document.getElementById('mode-indicator').textContent = `MODE: ${isSimulationMode ? 'SIMULATION' : 'GPS'}`;
  if (!isSimulationMode && "geolocation" in navigator) {
    startGPSTracking();
  }
}

function startGPSTracking() {
  navigator.geolocation.watchPosition(position => {
    const coords = `${position.coords.latitude}, ${position.coords.longitude}`;
    document.querySelector("#coordinates").textContent = coords;
    trainMoving = position.coords.speed > 0;
    updateTrainAnimation();
  });
}

function simulateMovement() {
  setInterval(() => {
    if (isSimulationMode && !isPaused) {
      currentStationIndex = (currentStationIndex + 1) % stations.length;
      const station = stations[currentStationIndex];
      document.querySelector("#current-station").textContent = `${station.jp} / ${station.name}`;
      if (!stationSound.paused) {
        stationSound.currentTime = 0;
      }
      stationSound.play().catch(e => console.log("Audio playback failed:", e));
    }
  }, 60000);
}

function updateTrainAnimation() {
  if (trainAnimation) {
    trainAnimation.timeScale(trainMoving ? 1 : 0);
  }
}

stations.forEach(station => {
  const stationEl = document.createElementNS("http://www.w3.org/2000/svg", "circle");
  stationEl.setAttribute("cx", station.pos.x);
  stationEl.setAttribute("cy", station.pos.y);
  stationEl.setAttribute("r", "5");
  stationEl.setAttribute("fill", "#fff");
  document.querySelector("#yamanote").appendChild(stationEl);
});

trainAnimation = gsap.to(".train", {
  duration: 20,
  motionPath: {
    path: ".track",
    align: ".track",
    autoRotate: true,
    alignOrigin: [0.5, 0.5]
  },
  repeat: -1,
  ease: "none",
  paused: true
});

let currentCar = 2;
document.addEventListener('keydown', (e) => {
  if(e.key === 'ArrowLeft' && currentCar > 1) {
    currentCar--;
    updatePlayerPosition();
  } else if(e.key === 'ArrowRight' && currentCar < 3) {
    currentCar++;
    updatePlayerPosition();
  }
});

function updatePlayerPosition() {
  const playerMarker = document.querySelector('.player-marker');
  const offset = -35 * (3 - currentCar);
  gsap.to(playerMarker, {
    duration: 0.5,
    x: offset,
    ease: "power2.inOut"
  });
  document.querySelector('#car-number').textContent = currentCar;
}

simulateMovement();

let hue = 0;
function animateBackground() {
  document.body.style.backgroundColor = `hsl(${hue}, 100%, 5%)`;
  hue = (hue + 1) % 360;
  requestAnimationFrame(animateBackground);
}
animateBackground();
</script>
</body>
</html>