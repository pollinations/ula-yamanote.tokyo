<html><head><base href="." /><title>ULAYAMANOTE.TOKYO - サイケデリック トレイン ビジュアライザー</title><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><style>
@import url('https://fonts.googleapis.com/css2?family=DotGothic16&display=swap');

body {
    margin: 0;
    padding: 0;
    background: #000;
    color: #0f0;
    font-family: 'DotGothic16', monospace;
    overflow: hidden;
}

.container {
    position: relative;
    width: 100vw;
    height: 100vh;
    background: linear-gradient(0deg, #000, #111);
}

.train-container {
    position: absolute;
    bottom: 20%;
    width: 100%;
    height: 200px;
    animation: float 3s infinite ease-in-out;
}

.train {
    width: 80%;
    height: 100px;
    margin: 0 auto;
    position: relative;
    display: flex;
    gap: 10px;
}

.carriage {
    flex: 1;
    background: #2d2d2d;
    border: 2px solid #0f0;
    box-shadow: 0 0 20px #0f0;
    animation: glow 2s infinite alternate;
    position: relative;
    background-image: 
        linear-gradient(90deg, rgba(0,255,0,0.1) 1px, transparent 1px),
        linear-gradient(rgba(0,255,0,0.1) 1px, transparent 1px);
    background-size: 10px 10px;
}

.carriage:first-child:before {
    content: '山';
    position: absolute;
    left: -30px;
    top: 20px;
    color: #0f0;
    font-size: 24px;
    text-shadow: 0 0 10px #0f0;
    animation: kanji-glow 2s infinite alternate;
}

.carriage:last-child:after {
    content: '手';
    position: absolute;
    right: -30px;
    top: 20px;
    color: #0f0;
    font-size: 24px;
    text-shadow: 0 0 10px #0f0;
    animation: kanji-glow 2s infinite alternate;
}

.window {
    position: absolute;
    width: 40px;
    height: 30px;
    background: #000;
    border: 2px solid #0f0;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    overflow: hidden;
}

.window:after {
    content: '';
    position: absolute;
    width: 200%;
    height: 200%;
    background: 
        repeating-linear-gradient(45deg,
            rgba(0,255,0,0.1) 0px,
            rgba(0,255,0,0.1) 10px,
            transparent 10px,
            transparent 20px
        );
    animation: window-pattern 20s linear infinite;
}

.connector {
    width: 10px;
    background: #0f0;
    height: 20px;
    position: absolute;
    right: -12px;
    top: 40px;
    z-index: 2;
}

.location-marker {
    position: absolute;
    width: 20px;
    height: 20px;
    background: #f00;
    border-radius: 50%;
    animation: pulse 1s infinite;
    z-index: 100;
    top: 40px;
}

.track {
    position: absolute;
    bottom: 15%;
    width: 100%;
    height: 10px;
    background: repeating-linear-gradient(
        90deg,
        #0f0 0px,
        #0f0 20px,
        transparent 20px,
        transparent 40px
    );
    animation: trackMove 10s infinite linear;
}

.effects {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 30% 30%, rgba(255,0,255,0.1) 0%, transparent 50%),
        radial-gradient(circle at 70% 70%, rgba(0,255,255,0.1) 0%, transparent 50%);
    mix-blend-mode: screen;
    animation: effectShift 8s infinite alternate;
}

.station-name {
    position: absolute;
    top: 20px;
    width: 100%;
    text-align: center;
    font-size: 24px;
    color: #0f0;
    text-shadow: 0 0 10px #0f0;
    animation: blink 1s infinite;
}

.station-name:after {
    content: attr(data-romaji);
    display: block;
    font-size: 14px;
    margin-top: 5px;
}

.grid {
    position: absolute;
    width: 100%;
    height: 100%;
    background: 
        linear-gradient(transparent 0%, rgba(0,255,0,0.2) 2%, transparent 5%),
        linear-gradient(90deg, transparent 0%, rgba(0,255,0,0.2) 2%, transparent 5%);
    background-size: 50px 50px;
    animation: gridMove 20s infinite linear;
}

.announcement {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.9);
    padding: 20px;
    border: 2px solid #0f0;
    z-index: 1000;
    text-align: center;
    width: 80%;
    max-width: 600px;
    box-shadow: 0 0 20px #0f0;
    animation: glitch 1s infinite;
}

.announcement-text {
    font-size: 18px;
    line-height: 1.5;
    margin: 0;
}

.kanji-decorations {
    position: fixed;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.kanji {
    position: absolute;
    color: rgba(0,255,0,0.1);
    font-size: 100px;
    animation: float-kanji 20s linear infinite;
}

.play-button {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    background: #000;
    border: 2px solid #0f0;
    color: #0f0;
    padding: 15px 30px;
    font-family: 'DotGothic16', monospace;
    font-size: 18px;
    cursor: pointer;
    z-index: 1000;
    box-shadow: 0 0 20px #0f0;
    transition: all 0.3s ease;
}

.play-button:hover {
    background: #0f0;
    color: #000;
}

.play-button::before {
    content: '▶';
    margin-right: 10px;
}

.play-button.playing {
    animation: button-pulse 2s infinite;
}

@keyframes button-pulse {
    0% { box-shadow: 0 0 20px #0f0; }
    50% { box-shadow: 0 0 40px #0f0; }
    100% { box-shadow: 0 0 20px #0f0; }
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

@keyframes glow {
    0% { box-shadow: 0 0 20px #0f0; }
    100% { box-shadow: 0 0 40px #0f0; }
}

@keyframes kanji-glow {
    0% { text-shadow: 0 0 10px #0f0; }
    100% { text-shadow: 0 0 20px #0f0, 0 0 40px #0f0; }
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 0.5; }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes trackMove {
    0% { background-position: 0 0; }
    100% { background-position: -800px 0; }
}

@keyframes effectShift {
    0% { transform: scale(1) rotate(0deg); }
    100% { transform: scale(1.2) rotate(10deg); }
}

@keyframes window-pattern {
    0% { transform: translateX(-50%) translateY(-50%) rotate(0deg); }
    100% { transform: translateX(-50%) translateY(-50%) rotate(360deg); }
}

@keyframes float-kanji {
    0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
    10% { opacity: 0.1; }
    90% { opacity: 0.1; }
    100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

@keyframes gridMove {
    0% { transform: translateY(0); }
    100% { transform: translateY(1000px); }
}

@keyframes glitch {
    0% { transform: translate(-50%, -50%) skew(0deg); }
    20% { transform: translate(-50%, -50%) skew(10deg); }
    40% { transform: translate(-50%, -50%) skew(-10deg); }
    60% { transform: translate(-50%, -50%) skew(5deg); }
    80% { transform: translate(-50%, -50%) skew(-5deg); }
    100% { transform: translate(-50%, -50%) skew(0deg); }
}
</style></head><body>
<div class="container">
    <div class="grid"></div>
    <div class="effects"></div>
    <div class="kanji-decorations"></div>
    <div class="station-name" data-romaji="SHIBUYA">渋谷</div>
    <div class="announcement">
        <p class="announcement-text">システム アラート:<br>ULA YAMANOTE<br>ローンチング アット<br>トラフィック クラブ 東京<br>六本木<br>2024</p>
    </div>
    <div class="train-container">
        <div class="train">
            <div class="carriage">
                <div class="window"></div>
                <div class="connector"></div>
            </div>
            <div class="carriage">
                <div class="window"></div>
                <div class="connector"></div>
            </div>
            <div class="carriage">
                <div class="window"></div>
                <div class="connector"></div>
            </div>
            <div class="carriage">
                <div class="window"></div>
                <div class="connector"></div>
            </div>
            <div class="carriage">
                <div class="window"></div>
                <div class="location-marker" id="userLocation"></div>
            </div>
        </div>
    </div>
    <div class="track"></div>
    <button class="play-button" id="audioControl">山手線 SOUND</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
<script>
const audio = new Audio('https://github.com/pollinations/ula-yamanote.tokyo/raw/refs/heads/main/convenience%20store%20-%20shabu%20shabu%20-%20please%20be%20careful.mp3');
const audioButton = document.getElementById('audioControl');

audioButton.addEventListener('click', () => {
    if (audio.paused) {
        audio.play();
        audioButton.classList.add('playing');
    } else {
        audio.pause();
        audio.currentTime = 0;
        audioButton.classList.remove('playing');
    }
});

// Add audio loop functionality
audio.addEventListener('ended', () => {
    audio.currentTime = 0;
    audio.play();
});

// Add error handling for audio
audio.addEventListener('error', (e) => {
    console.error('Error loading audio:', e);
    audioButton.textContent = 'Audio Error';
    audioButton.style.color = '#f00';
});

// Update the Tone.js section to stop random notes when the audio file is playing
audio.addEventListener('play', () => {
    Tone.Transport.stop();
});

audio.addEventListener('pause', () => {
    Tone.Transport.start();
});

const japaneseStations = [
    ["渋谷", "Shibuya"], ["原宿", "Harajuku"], ["代々木", "Yoyogi"], 
    ["新宿", "Shinjuku"], ["新大久保", "Shin-Okubo"], ["高田馬場", "Takadanobaba"],
    ["目白", "Mejiro"], ["池袋", "Ikebukuro"], ["大塚", "Otsuka"], 
    ["巣鴨", "Sugamo"], ["駒込", "Komagome"], ["田端", "Tabata"],
    ["西日暮里", "Nishi-Nippori"], ["日暮里", "Nippori"], ["鶯谷", "Uguisudani"],
    ["上野", "Ueno"], ["御徒町", "Okachimachi"], ["秋葉原", "Akihabara"],
    ["神田", "Kanda"], ["東京", "Tokyo"], ["有楽町", "Yurakucho"],
    ["新橋", "Shinbashi"], ["浜松町", "Hamamatsucho"], ["田町", "Tamachi"],
    ["品川", "Shinagawa"], ["大崎", "Osaki"], ["五反田", "Gotanda"],
    ["目黒", "Meguro"], ["恵比寿", "Ebisu"]
];

const kanjiChars = '山手線電車駅東京都交通';
let currentStationIndex = 0;
const stationNameElement = document.querySelector('.station-name');
const announcement = document.querySelector('.announcement');
const kanjiContainer = document.querySelector('.kanji-decorations');

// Add floating kanji
function addFloatingKanji() {
    const kanji = document.createElement('div');
    kanji.className = 'kanji';
    kanji.style.left = `${Math.random() * 100}%`;
    kanji.textContent = kanjiChars[Math.floor(Math.random() * kanjiChars.length)];
    kanjiContainer.appendChild(kanji);
    
    kanji.addEventListener('animationend', () => {
        kanjiContainer.removeChild(kanji);
    });
}

setInterval(addFloatingKanji, 2000);

// Add glitch effect to announcement text
setInterval(() => {
    const text = announcement.querySelector('.announcement-text');
    if (Math.random() > 0.9) {
        text.style.transform = `skew(${Math.random() * 10 - 5}deg)`;
        text.style.textShadow = `${Math.random() * 10 - 5}px ${Math.random() * 10 - 5}px #f0f`;
        setTimeout(() => {
            text.style.transform = 'skew(0deg)';
            text.style.textShadow = 'none';
        }, 100);
    }
}, 100);

// Simulated train movement
setInterval(() => {
    currentStationIndex = (currentStationIndex + 1) % japaneseStations.length;
    stationNameElement.textContent = japaneseStations[currentStationIndex][0];
    stationNameElement.dataset.romaji = japaneseStations[currentStationIndex][1];
}, 5000);

// Simulated user location in train
function updateUserLocation() {
    const currentCarriage = document.querySelector('.carriage:last-child');
    const userLocation = document.getElementById('userLocation');
    const carriageWidth = currentCarriage.offsetWidth;
    const position = (Math.sin(Date.now() / 1000) + 1) / 2;
    userLocation.style.left = `${position * (carriageWidth - 20)}px`;
}

setInterval(updateUserLocation, 50);

// Initialize Tone.js
const synth = new Tone.Synth().toDestination();
const notes = ['C5', 'D5', 'E5', 'G5', 'A5'];

// Play random notes based on movement
setInterval(() => {
    if (Math.random() > 0.7) {
        const note = notes[Math.floor(Math.random() * notes.length)];
        synth.triggerAttackRelease(note, '0.1');
    }
}, 500);

// Simulated GPS location (would need to be replaced with actual GPS data)
if ("geolocation" in navigator) {
    navigator.geolocation.watchPosition((position) => {
        console.log("Location updated:", position.coords.latitude, position.coords.longitude);
    }, (error) => {
        console.error("Error getting location:", error);
    });
}
</script></body></html>